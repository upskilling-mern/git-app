name: CI Pipeline

on:
  push:
    branches:
      - dev
      - main
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout code
      - name: Checkout code
        uses: actions/checkout@v4

      # 2️⃣ Setup Docker
      - name: Set up Docker
        uses: docker/setup-buildx-action@v3

      # 3️⃣ Build Backend Image
      - name: Build Backend
        run: |
          docker build -t products-backend ./BE

      # 4️⃣ Build Frontend Image
      - name: Build Frontend
        run: |
          docker build \
            --build-arg VITE_API_URL=http://backend:4000 \
            -t products-frontend ./FE

      # 5️⃣ (Optional but recommended) Validate compose
      - name: Docker Compose Config Check
        run: docker compose -f docker-compose.dev.yml config
